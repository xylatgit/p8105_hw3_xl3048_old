---
title: "Homework 3"
author: "Xiangyi Liu (xl3048)"
date: "10/6/2020"
output: github_document
---


```{r setup, include=FALSE}
library(tidyverse)
library(p8105.datasets)

knitr::opts_chunk$set(
	fig.width = 6, 
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1
```{r data}
data("instacart")
```
This dataset contains `r nrow(instacart)` rows and ... columns. 

Observations are the level of items in orders by user. There are user / order variables -- user ID, order ID, order day, and order hour. There are also item variables -- name, aisle, department, and some numeric codes. 

How many aisles, and which are most items from?

```{r}
instacart %>%
  count(aisle) %>%
  arrange(desc(n))
```

Make plot.
```{r scatterplot}
instacart %>%
  count(aisle) %>%
  filter(n > 1000) %>%
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle,n) #reorder factor 'aisle' based on 'n'
  ) %>%
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1) )
```

Make a table.
```{r table}
instacart %>%
  filter(aisle %in% c("baking ingredients", "dog food care","packaged vegetables fruits")) %>%
  group_by(aisle) %>%
  count(product_name) %>%
  mutate(rank = min_rank(desc(n))) %>%
  filter(rank < 4) %>%
  arrange(aisle, rank) %>%
  knitr::kable()
```

Apple vs. ice cream.
```{r}
instacart %>%
  filter(product_name %in% c("Pink Lady Apple", "Coffee Ice Cream")) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day)) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour
  )

```

## Problem 2
```{r data import}
accel_df <-
  read.csv("accel_data.csv") %>%
  rename(day_of_week = day) 
  
day_info <-
  accel_df %>% select(week:day_of_week)

accel_df <-
  accel_df%>%
  pivot_longer(
    activity.1:activity.1440,
    names_to = "minute_of_day",
    names_prefix = "activity.",
    values_to = "activity_count"
  ) %>%
  mutate(
    day_id = as.factor(day_id),
    week = as.factor(week),
    day_of_week = as.factor(day_of_week),
    weekday_weekend = case_when(
      day_of_week %in% c("Saturday","Sunday") ~ "weekend",
      day_of_week %in% c("Monday","Tuesday","Wednesday","Thursday","Friday") ~ "weekday"
    ) ,
    weekday_weekend = as.factor(weekday_weekend)
  ) %>%
  relocate(week,day_id,weekday_weekend)
```

The resulting dataset has `r nrow(accel_df)` observations and `r ncol(accel_df)` variables, which are {`r colnames(accel_df)`}. All variables are factors except minute_of_day and activity_count, which is numeric.

```{r, message=FALSE}
accel_total <-
  accel_df %>%
  group_by(day_id) %>%
  summarise(total_activity = sum(activity_count)) 

day_info <-
  day_info %>%
  mutate(
    weekday_weekend = case_when(
      day_of_week %in% c("Saturday","Sunday") ~ "weekend",
      day_of_week %in% c("Monday","Tuesday","Wednesday","Thursday","Friday") ~ "weekday"
    ) ,
    weekday_weekend = as.factor(weekday_weekend),
    day_id = as.factor(day_id)
  )

day_info <-
 day_info %>% left_join(accel_total, by = "day_id") 
  
day_info %>% knitr::kable()
```
From the table alone, we can observe that the person gradually has less activity when the recording approaching to the end. There are two extreme low values on day 24 and day 31. On average, the person has less activity on Wednesdays.

```{r plot_p2}
ggplot(accel_df, aes(x=minute_of_day, y=activity_count)) +
  geom_point(aes(color=day_of_week),alpha = 0.5) +
  labs(title = "Activity Over The Day",
       x = "Minute of the day",
       y = "Activity Count") +
  geom_smooth(se=FALSE)
```

From the plot above, we can see that most pink dots gather at the bottom, which means that the person has less activity on Wednesdays during the observation.  





